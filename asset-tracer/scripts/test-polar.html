<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polar API Tester - AssetTracer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            color: #555;
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .result.success {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
        }
        
        .result.error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }
        
        .result.info {
            background: #e0e7ff;
            border: 2px solid #6366f1;
            color: #3730a3;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .info-box {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #92400e;
            font-size: 13px;
        }
        
        .info-box strong {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üß™ Polar API Tester</h1>
            <p class="subtitle">Test your Polar.sh API integration for AssetTracer</p>
            
            <div class="info-box">
                <strong>‚ö†Ô∏è Important:</strong>
                This page tests your local API endpoints. Make sure your development server is running at 
                <code>http://localhost:3000</code> before testing.
            </div>
            
            <div class="section">
                <div class="section-title">1Ô∏è‚É£ Test API Connection</div>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    First, verify your Polar API credentials are configured correctly.
                </p>
                <div class="button-group">
                    <button class="btn-primary" onclick="testConnection()">
                        Test Connection
                    </button>
                </div>
                <div id="connectionResult"></div>
            </div>
            
            <div class="section">
                <div class="section-title">2Ô∏è‚É£ List Products</div>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    Check what products are configured in your Polar account.
                </p>
                <div class="button-group">
                    <button class="btn-primary" onclick="listProducts()">
                        List Products
                    </button>
                </div>
                <div id="productsResult"></div>
            </div>
            
            <div class="section">
                <div class="section-title">3Ô∏è‚É£ Create Test Customer</div>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    Create a test customer for subscription testing.
                </p>
                <div class="form-group">
                    <label for="customerEmail">Email Address</label>
                    <input type="email" id="customerEmail" placeholder="test@example.com" value="test@example.com">
                </div>
                <div class="form-group">
                    <label for="customerName">Full Name</label>
                    <input type="text" id="customerName" placeholder="Test User" value="Test User">
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="createCustomer()">
                        Create Customer
                    </button>
                </div>
                <div id="customerResult"></div>
            </div>
            
            <div class="section">
                <div class="section-title">4Ô∏è‚É£ Create Test Subscription</div>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    Create a test subscription using the customer ID from step 3.
                </p>
                <div class="form-group">
                    <label for="customerId">Customer ID</label>
                    <input type="text" id="customerId" placeholder="cus_xxxxx">
                </div>
                <div class="form-group">
                    <label for="productId">Product (Plan)</label>
                    <select id="productId">
                        <option value="4bd7788b-d3dd-4f17-837a-3a5a56341b05">Pro Plan - $19/month</option>
                        <option value="bbb245ef-6915-4c75-b59f-f14d61abb414">Business Plan - $39/month</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="createSubscription()">
                        Create Subscription
                    </button>
                </div>
                <div id="subscriptionResult"></div>
            </div>
            
            <div class="section">
                <div class="section-title">5Ô∏è‚É£ List Subscriptions</div>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                    View all existing subscriptions in your account.
                </p>
                <div class="button-group">
                    <button class="btn-primary" onclick="listSubscriptions()">
                        List Subscriptions
                    </button>
                </div>
                <div id="subscriptionsResult"></div>
            </div>
        </div>
        
        <div class="card" style="background: #f9fafb; border: 2px solid #e5e7eb;">
            <h2 style="font-size: 18px; color: #333; margin-bottom: 15px;">üìö Quick Reference</h2>
            <div style="font-size: 13px; color: #666; line-height: 1.8;">
                <p><strong>Product IDs:</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>Pro Plan: <code>4bd7788b-d3dd-4f17-837a-3a5a56341b05</code></li>
                    <li>Business Plan: <code>bbb245ef-6915-4c75-b59f-f14d61abb414</code></li>
                </ul>
                <p><strong>Test Credit Cards:</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>Success: <code>4242 4242 4242 4242</code></li>
                    <li>Decline: <code>4000 0000 0000 0002</code></li>
                </ul>
                <p><strong>Server Status:</strong> <span id="serverStatus">Checking...</span></p>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:3000/api';
        
        // Check server status on load
        window.onload = function() {
            checkServerStatus();
        };
        
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/test-polar-direct`);
                if (response.ok) {
                    document.getElementById('serverStatus').innerHTML = 
                        '<span class="status-badge status-success">‚úÖ Online</span>';
                } else {
                    document.getElementById('serverStatus').innerHTML = 
                        '<span class="status-badge status-error">‚ùå Error</span>';
                }
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = 
                    '<span class="status-badge status-error">‚ùå Offline</span>';
            }
        }
        
        function showResult(elementId, data, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${JSON.stringify(data, null, 2)}</div>`;
        }
        
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div class="result info">Loading<span class="loading"></span></div>';
        }
        
        async function testConnection() {
            showLoading('connectionResult');
            try {
                const response = await fetch(`${API_BASE}/test-polar-direct`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showResult('connectionResult', {
                        status: 'success',
                        message: '‚úÖ API connection successful!',
                        data: data.data
                    }, 'success');
                } else {
                    showResult('connectionResult', {
                        status: 'error',
                        message: '‚ùå API connection failed',
                        error: data
                    }, 'error');
                }
            } catch (error) {
                showResult('connectionResult', {
                    status: 'error',
                    message: '‚ùå Failed to connect to server',
                    error: error.message
                }, 'error');
            }
        }
        
        async function listProducts() {
            showLoading('productsResult');
            try {
                // Note: You'll need to create this endpoint
                const response = await fetch(`${API_BASE}/test-polar-direct`);
                const data = await response.json();
                
                showResult('productsResult', {
                    status: 'info',
                    message: 'üì¶ To list products, create a /api/products endpoint',
                    note: 'Or use the PowerShell/Node.js scripts'
                }, 'info');
            } catch (error) {
                showResult('productsResult', {
                    status: 'error',
                    message: '‚ùå Failed to fetch products',
                    error: error.message
                }, 'error');
            }
        }
        
        async function createCustomer() {
            const email = document.getElementById('customerEmail').value;
            const name = document.getElementById('customerName').value;
            
            if (!email || !name) {
                alert('Please fill in all customer fields');
                return;
            }
            
            showLoading('customerResult');
            showResult('customerResult', {
                status: 'info',
                message: 'üí° To create customers via this UI, implement an API endpoint',
                alternative: 'Use the PowerShell or Node.js scripts for now',
                email: email,
                name: name
            }, 'info');
        }
        
        async function createSubscription() {
            const customerId = document.getElementById('customerId').value;
            const productId = document.getElementById('productId').value;
            
            if (!customerId) {
                alert('Please enter a customer ID');
                return;
            }
            
            showLoading('subscriptionResult');
            showResult('subscriptionResult', {
                status: 'info',
                message: 'üí° To create subscriptions via this UI, implement an API endpoint',
                alternative: 'Use the PowerShell or Node.js scripts for now',
                customerId: customerId,
                productId: productId
            }, 'info');
        }
        
        async function listSubscriptions() {
            showLoading('subscriptionsResult');
            showResult('subscriptionsResult', {
                status: 'info',
                message: 'üí° To list subscriptions via this UI, implement an API endpoint',
                alternative: 'Use the PowerShell or Node.js scripts for now',
                note: 'Or check your Polar dashboard at https://polar.sh'
            }, 'info');
        }
    </script>
</body>
</html>

